pipeline{
	agent any
	environment {
		RELEASE = '1.3'
	}

	stages{
		stage('Build'){
			agent any
			environment {
				LOG_LEVEL = 'INFO'
			}
			steps{
				sh "echo Build - Release ${RELEASE} for LogLevel ${LOG_LEVEL}"
			}
		}
		stage('Test'){
			steps{
				sh "echo Testing - Release ${RELEASE} "
			}
		}
		stage('Deploy'){
			input{
				message 'Deploy?'
				ok 'Do It!!'
				parameters{
					string(name:'TARGET_ENVIRONMENT', defaultValue:'PROD',description:'Target deployment environment')
				}				
			}
			steps{
				sh "echo Deploying - Release ${RELEASE} to environment ${TARGET_ENVIRONMENT} "
				writeFile file:'test_result.txt', text: 'successfully deployed!!!'
			}
		}
	}
	
	post{
		always{
			echo 'Prints whether deploy happened or not, success or failure'
		}
		success{
			archiveArtifacts 'test-results.txt'
		}
	}
}
